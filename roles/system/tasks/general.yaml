---

- name: Block for all hosts
  tags:
      - general
      - system
      - setup
  block:

    - name: Update apt package list
      ansible.builtin.apt:
        update_cache: yes

    - name: Install required packages
      ansible.builtin.apt:
        name:
          - unattended-upgrades
          - apt-transport-https
          - ca-certificates
          - curl
          - wget
          - gpg
          - coreutils
          - git
          - htop
          - nano
          - unzip
          - figlet
          - golang
        state: present

    - name: Generate /etc/hosts file
      ansible.builtin.template:
        src: "{{ role_path }}/templates/hosts.j2"
        dest: /etc/hosts

    - name: Enable unattended upgrades
      ansible.builtin.apt:
        upgrade: dist
        update_cache: yes

    - name: Configure unattended-upgrades
      ansible.builtin.copy:
        content: |
          Unattended-Upgrade::Origins-Pattern {
            "o=Ubuntu,a=stable";
            "o=Ubuntu,a=stable-security";
            "o=Ubuntu,a=stable-updates";
          };
          Unattended-Upgrade::Automatic-Reboot "true";
        dest: /etc/apt/apt.conf.d/50unattended-upgrades