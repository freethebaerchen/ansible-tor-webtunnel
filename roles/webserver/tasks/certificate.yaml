---

- name: Block for certificate request
  block:
    - name: Request certificate
      ansible.builtin.shell: |
        certbot certonly --webroot -w {{ webserver.webroot }} --cert-name {{ domain }} -d {{ domain }} --non-interactive --email {{ email }} --agree-tos --config-dir {{ certbot.config_dir }}
      register: certbot_output
      changed_when: "'Certificate not yet due for renewal' not in certbot_output.stdout"
