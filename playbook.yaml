---

- name: Setup Infrastructure in HCloud
  hosts: localhost
  become: false
  roles:
    - hetzner
  tags:
    - infrastructure
    - hetzner
    - hcloud

- name: Set Python interpreter
  hosts: all
  gather_facts: false
  tasks:
    - name: Detect OS
      ansible.builtin.command:
        cmd: uname -s
      register: uname_result
      changed_when: false

    - name: Set Python interpreter based on OS
      ansible.builtin.set_fact:
        ansible_python_interpreter: "{{ '/usr/local/bin/python3' if 'BSD' in uname_result.stdout else '/usr/bin/python3' }}"
  tags:
    - always

- name: Setup general system
  hosts: all
  become: true
  roles:
    - system
  tags:
    - system
    - general

- name: Setup the WebSocket Bridge
  hosts: all
  become: true
  roles:
    - tor
  tags:
    - tor
    - bridge
    - webtunnel

- name: Setup webserver
  hosts: all
  become: true
  roles:
    - webserver
  tags:
    - webserver

- name: Setup firewall
  hosts: all
  become: true
  roles:
    - security
  tags:
    - security
