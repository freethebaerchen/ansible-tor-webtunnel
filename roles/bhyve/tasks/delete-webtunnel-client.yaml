---

- name: Block for deleting webtunnel-client
  tags:
    - delete-webtunnel-client
  block:
    - name: Forcefully shutdown {{ vm[os].name }}-webtunnel-client
      shell: vm poweroff -f {{ vm[os].name }}-webtunnel-client

    - name: Wait until VM is stopped
      ansible.builtin.shell: vm list | grep "{{ vm[os].name }}-webtunnel-client" | awk '{print $NF}'
      register: vm_status
      retries: 10
      delay: 3
      until: vm_status.stdout == "Stopped"

    - name: Delete selected vms
      ansible.builtin.shell: vm destroy {{ vm[os].name }}-webtunnel-client